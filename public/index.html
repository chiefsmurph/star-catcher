<html>
  <head>
    <title>Star Catcher</title>

    <style>
    body {
      overflow-x: hidden;
    }
    #gamearea {
      background-image: url('img/sky.jpg');
      background-size: cover;
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 140%;
    }
    .star {
      position: absolute;
      width: 50px;
      height: 50px;

    }
    .fast-star {
       -webkit-animation-name: spin;
       -webkit-animation-duration: 4000ms;
       -webkit-animation-iteration-count: infinite;
       -webkit-animation-timing-function: linear;
       -moz-animation-name: spin;
       -moz-animation-duration: 4000ms;
       -moz-animation-iteration-count: infinite;
       -moz-animation-timing-function: linear;
       -ms-animation-name: spin;
       -ms-animation-duration: 4000ms;
       -ms-animation-iteration-count: infinite;
       -ms-animation-timing-function: linear;

       animation-name: spin;
       animation-duration: 4000ms;
       animation-iteration-count: infinite;
       animation-timing-function: linear;
    }
    @-ms-keyframes spin {
       from { -ms-transform: rotate(0deg); }
       to { -ms-transform: rotate(-360deg); }
    }
    @-moz-keyframes spin {
       from { -moz-transform: rotate(0deg); }
       to { -moz-transform: rotate(-360deg); }
    }
    @-webkit-keyframes spin {
       from { -webkit-transform: rotate(0deg); }
       to { -webkit-transform: rotate(-360deg); }
    }
    @keyframes spin {
       from {
           transform:rotate(0deg);
       }
       to {
           transform:rotate(360deg);
       }
    }

    #bucket {
      position: absolute;
      bottom: 10px;
      left: 10px;
    }
    #bucket img {
      width: 100px;
    }
    #bucket #top {
      z-index: 1;
    }
    #bucket #bottom {
      position: relative;
      left: -104px;
      z-index: 2;
    }
    * {
      -moz-user-select: none;
      -khtml-user-select: none;
      -webkit-user-select: none;
      -o-user-select: none;
    }
    #scoreboard {
      position: absolute;
      top: 10px;
      right: 30%;
      width: 200px;
      height: 150px;
      z-index: 10000;
      background-color: rgba(255,255,255,0.4);
      border-radius: 10px;
      padding: 15px;
    }
    #scoreboard > div {
      width: 100px;
      margin: 0 0 20px;
    }
    #scoreboard div div {
      margin-right: 1em;
      font-size: 250%;
      margin-bottom: 0;
      line-height: 1;
    }
    #scoreboard div:first-of-type {
      /*float: left;*/
    }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script>

    var height, width;
    var spaceBtnDrops = 2000;

    var dropStar = function() {
      var starEl = $('<img src="img/golden-star.svg.png" class="star">');

      starEl.css('left', Math.round(Math.random() * (width-50) ) + 'px' );
      starEl.css('top', '-50px');
      $('#gamearea').append(starEl);

      var duration = 1000 + Math.round(Math.random() * 2000);
      if (duration < 1500) {
        starEl.addClass('fast-star');
      }

      starEl.animate({top: height}, {
        easing: "linear",
        duration: duration,
        step: function(now, fx) {
          //console.log(fx.elem.id + " " + fx.prop + ": " + now);


          // check for bucket catch
          var starX = $(this).position().left;
          var starY = now;

          var bucketPos = $('#bucket').position();

          if (starY > bucketPos.top - 10) {
            if (starX > bucketPos.left - 30 && starX < bucketPos.left + 100) {

              console.log('caught');
              $(this).stop();
              $(this).remove();
              $('#starscaught').text(parseInt($('#starscaught').text()) + 1);

            }
          }


        },
        complete: function() {
          $(this).remove();
          console.log('complete');
          $('#starsfallen').text(parseInt($('#starsfallen').text()) + 1);
        }
      });
    }

    $(function() {

      height = $(window).height();
      width = $(window).width();

      (function startStars() {
        dropStar();
        if (spaceBtnDrops > 100) spaceBtnDrops *= 0.97;
        //console.log(spaceBtnDrops);
        setTimeout(startStars, spaceBtnDrops);
      })();

    });

    $(window).resize(function() {
      height = $(window).height();
      width = $(window).width();
    });


    $(document).ready(function() {
        var $dragging = null;

        $(document.body).on("mousemove", function(e) {
            if ($dragging) {
                $dragging.css({
                    left: e.pageX - 50
                });
            }
        });


        $(document.body).on("mousedown", "#bucket", function (e) {
            $dragging = ($dragging) ? null : $('#bucket');
        });

        // $(document.body).on("mouseup", function (e) {
        //     $dragging = null;
        // });

        $('img').on('dragstart', function(event) { event.preventDefault(); });
    });
    </script>

  </head>
  <body>

    <div id="gamearea">

      <div id="scoreboard">
        <!-- <div id="timeleft">0</div> -->
        <div>
          <div id="starscaught">0</div>
          stars caught
        </div>
        <div>
          <div id="starsfallen">0</div>
          stars fallen
        </div>
      </div>
      <div id="bucket">
        <img src="img/topbucket.png" id="top">
        <img src="img/bottombucket.png" id="bottom">
      </div>
    </div>

    <!-- <script src="https://cdn.socket.io/socket.io-1.3.5.js"></script> -->
    <!-- <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script> -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.2/TweenLite.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.2/easing/EasePack.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.2/jquery.gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.18.2/plugins/CSSPlugin.min.js"></script>

  </body>
</html>
